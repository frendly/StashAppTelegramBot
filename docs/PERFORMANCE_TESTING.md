# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ù–æ–≤—ã–π –º–æ–¥—É–ª—å** `bot/performance.py` —Å —É—Ç–∏–ª–∏—Ç–∞–º–∏ –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏** –¥–ª—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
3. **–î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç** –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ

### ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤** - —Å–ø–∏—Å–∫–∏ blacklist/whitelist –∫—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 60 —Å–µ–∫—É–Ω–¥
2. **–£–º–µ–Ω—å—à–µ–Ω GraphQL –∑–∞–ø—Ä–æ—Å** - —Å 50 –¥–æ 20 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
3. **–£–±—Ä–∞–Ω—ã —Ç–µ–≥–∏** –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ç–æ)

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

```bash
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Docker
cd /Users/ikpopov/projects/bot-rand-nl-photo
docker-compose up -d
docker-compose logs -f bot

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
python -m bot.main
```

### 2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/random` –≤ Telegram

–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã –≤ –ª–æ–≥–∞—Ö –ø–æ—è–≤–∏—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç:

```
============================================================
‚è±Ô∏è  Performance Report: Send random photo
------------------------------------------------------------
  Get recent IDs from DB...................... 0.003s (  0.5%)
  Get filtering lists from DB................. 0.009s (  1.5%)
  Get random image (weighted)................. 0.455s ( 75.4%)
  Download image.............................. 0.120s ( 19.9%)
  Send to Telegram............................ 0.015s (  2.5%)
  Save to database............................ 0.002s (  0.3%)
------------------------------------------------------------
  TOTAL....................................... 0.604s (100.0%)
============================================================
```

### 3. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ TOTAL –≤—Ä–µ–º—è:**
- ‚úÖ **< 3 —Å–µ–∫** - –æ—Ç–ª–∏—á–Ω–æ!
- ‚ö†Ô∏è **3-5 —Å–µ–∫** - –ø—Ä–∏–µ–º–ª–µ–º–æ
- ‚ùå **> 5 —Å–µ–∫** - —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**–ù–∞–π–¥–∏—Ç–µ —Å–∞–º—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π —ç—Ç–∞–ø** (—Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º):

#### –ï—Å–ª–∏ "Get random image (weighted)" –∑–∞–Ω–∏–º–∞–µ—Ç > 70%:
- –ü—Ä–æ–±–ª–µ–º–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ –∫ StashApp
- –í–æ–∑–º–æ–∂–Ω–æ, —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã (–º–Ω–æ–≥–æ retry)
- –í–æ–∑–º–æ–∂–Ω–æ, –º–µ–¥–ª–µ–Ω–Ω–∞—è —Å–µ—Ç—å –º–µ–∂–¥—É –±–æ—Ç–æ–º –∏ StashApp

#### –ï—Å–ª–∏ "Download image" –∑–∞–Ω–∏–º–∞–µ—Ç > 40%:
- Preview —Ñ–∞–π–ª—ã —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ
- –ú–æ–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö StashApp
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å thumbnail –≤–º–µ—Å—Ç–æ preview

#### –ï—Å–ª–∏ "Send to Telegram" –∑–∞–Ω–∏–º–∞–µ—Ç > 30%:
- –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- Telegram API –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –º–µ–¥–ª–µ–Ω–Ω–æ

#### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ thumbnail –≤–º–µ—Å—Ç–æ preview

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `bot/stash_client.py`, —Å—Ç—Ä–æ–∫–∞ ~26:

```python
# –ë—ã–ª–æ:
self.image_url = paths.get('preview') or paths.get('image', '')

# –°—Ç–∞–ª–æ:
self.image_url = paths.get('thumbnail') or paths.get('preview') or paths.get('image', '')
```

Thumbnail –æ–±—ã—á–Ω–æ ~10-20 KB –≤–º–µ—Å—Ç–æ ~50-100 KB preview.

#### 2. –£–º–µ–Ω—å—à–∏—Ç–µ —Ä–∞–∑–º–µ—Ä preview –≤ StashApp

1. –û—Ç–∫—Ä–æ–π—Ç–µ StashApp Web UI
2. Settings ‚Üí Interface
3. "Maximum image preview size" ‚Üí —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **400px** –∏–ª–∏ –º–µ–Ω—å—à–µ

#### 3. –£–≤–µ–ª–∏—á—å—Ç–µ TTL –∫—ç—à–∞

–ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ä–µ–¥–∫–æ, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `bot/main.py`, —Å—Ç—Ä–æ–∫–∞ ~94:

```python
# –ë—ã–ª–æ:
voting_manager = VotingManager(
    database=database,
    stash_client=stash_client
)

# –°—Ç–∞–ª–æ (–∫—ç—à –Ω–∞ 5 –º–∏–Ω—É—Ç):
voting_manager = VotingManager(
    database=database,
    stash_client=stash_client,
    cache_ttl=300
)
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ "–¥–æ" –∏ "–ø–æ—Å–ª–µ"

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:
- ‚ùå –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚ùå –ó–∞–ø—Ä–æ—Å 50 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π + —Ç–µ–≥–∏
- ‚ùå –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î –Ω–∞ –∫–∞–∂–¥—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
- ‚ùå –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–æ–µ –≤—Ä–µ–º—è: 5-10+ —Å–µ–∫—É–Ω–¥

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ó–∞–ø—Ä–æ—Å 20 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–µ–∑ —Ç–µ–≥–æ–≤
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- ‚úÖ –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è: 2-4 —Å–µ–∫—É–Ω–¥—ã

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∞–Ω–∞–ª–∏–∑—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
üìÑ **docs/PERFORMANCE_ANALYSIS.md**

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞** –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ `/random`
2. **–ò–∑—É—á–∏—Ç–µ –ª–æ–≥–∏** - –Ω–∞–π–¥–∏—Ç–µ —É–∑–∫–æ–µ –º–µ—Å—Ç–æ
3. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (—Å–º. –≤—ã—à–µ)
4. **–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —Ç–µ—Å—Ç** - —Å—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

**–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã** - –±–æ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ, –Ω–æ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
